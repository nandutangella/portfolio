<!DOCTYPE html>
<html>
<head>
	<title>Test Function</title>
</head>
<body>
	<h1>Test Cloudflare Pages Function</h1>
	<button onclick="testFunction()">Test /api/chat</button>
	<pre id="result"></pre>

	<script>
		async function testFunction() {
			const resultEl = document.getElementById('result');
			resultEl.textContent = 'Testing...';
			
			try {
				const response = await fetch('/api/chat', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ 
						message: 'test', 
						chat_history: [], 
						preamble: 'test', 
						model: 'command-r-08-2024', 
						temperature: 0.7, 
						max_tokens: 150 
					})
				});
				
				// Get response as text first to see what we're actually getting
				const text = await response.text();
				
				let data;
				try {
					data = JSON.parse(text);
				} catch (e) {
					// If not JSON, show the raw response
					resultEl.textContent = `Status: ${response.status} ${response.statusText}\n\nRaw Response (first 500 chars):\n${text.substring(0, 500)}`;
					return;
				}
				
				resultEl.textContent = JSON.stringify({
					status: response.status,
					statusText: response.statusText,
					headers: Object.fromEntries(response.headers.entries()),
					data: data
				}, null, 2);
			} catch (error) {
				resultEl.textContent = 'Error: ' + error.message + '\n\n' + error.stack;
			}
		}
	</script>
</body>
</html>
